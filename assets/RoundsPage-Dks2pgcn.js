import{r as x,j as r,R as I,a as w}from"./index-ka8mHZOX.js";import{I as P}from"./IconTabs-DWliYqlE.js";import{I as M}from"./IconNext-8ZQh6qJC.js";import{e as p,H as N,u as d,f as S,h as k,i as O,j as T,P as L,a as z,b as D,c as B,d as H,B as j}from"./PageLayout-DdG_ieDa.js";import{a as h,c as Y,I as U,b as q}from"./IconAdd-DxIQ5hdC.js";function F(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];t&&t.addEventListener&&t.addEventListener.apply(t,e)}function V(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];t&&t.removeEventListener&&t.removeEventListener.apply(t,e)}var $=["mousedown","touchstart"],G=function(t,e,s){s===void 0&&(s=$);var o=x.useRef(e);x.useEffect(function(){o.current=e},[e]),x.useEffect(function(){for(var a=function(u){var c=t.current;c&&!c.contains(u.target)&&o.current(u)},n=0,l=s;n<l.length;n++){var f=l[n];F(document,f,a)}return function(){for(var u=0,c=s;u<c.length;u++){var i=c[u];V(document,i,a)}}},[s,t])};const y=({name:t,score:e,onChange:s,disabled:o,variant:a})=>{const[n,l]=x.useState(!1),f=x.useRef(null);G(f,()=>{n&&l(!1)});const u=a==="primary"?"border-primary":"border-secondary";return r.jsxs("div",{className:"flex flex-row items-stretch justify-between gap-0.5",children:[r.jsx("h5",{className:`flex flex-auto items-center border pl-3 font-bold text-lg ${o?"border-gray-300 text-gray-300":u}`,children:t}),r.jsxs("div",{ref:f,className:"flex flex-row ",children:[n&&r.jsx("span",{className:"h-[54px] w-[54px]",children:r.jsx(h,{onClick:()=>s==null?void 0:s(e>0?e-1:e),iconSlot:r.jsx(Y,{}),shape:"circle"})}),r.jsx("form",{autoComplete:"off",onSubmit:i=>{i.preventDefault(),n&&l(!1)},children:r.jsx(U,{className:"h-[54px] w-[54px] text-center",type:"text",name:"score",value:e,readOnly:!0,disabled:o,onFocus:()=>{l(!o&&!0)},onChange:i=>s==null?void 0:s(Number.parseInt(i.target.value))})}),n&&r.jsx("span",{className:"ml-0.5 h-[54px] w-[54px]",children:r.jsx(h,{onClick:()=>s==null?void 0:s(e+1),iconSlot:r.jsx(q,{}),shape:"circle"})})]})]})},v=({names:t,match:e,onScoreChange:s,disabled:o=!1,variant:a="secondary"})=>{const[n,l]=x.useState(!1),f=x.useRef(null),u=c=>{l(c)};return x.useEffect(()=>{if(n){const c=setTimeout(()=>{var i;(i=f.current)==null||i.scrollIntoView({block:"center",behavior:"smooth"})},100);return()=>{clearTimeout(c)}}return()=>{}},[n]),r.jsxs("div",{ref:f,className:"flex flex-col",children:[r.jsx("div",{className:"focus-within:z-10",children:r.jsx(y,{name:t[0],score:e.result[0],disabled:o,variant:a,onChange:c=>{const i={...e,result:[c,e.result[1]]};s==null||s(i)},onIsEditingChange:u,highlight:e.result[0]>e.result[1]})}),r.jsx("div",{className:"-mt-[1px] focus-within:z-10",children:r.jsx(y,{name:t[1],score:e.result[1],disabled:o,variant:a,onChange:c=>{const i={...e,result:[e.result[0],c]};s==null||s(i)},onIsEditingChange:u,highlight:e.result[1]>e.result[0]})})]})};function E(t,e){if(!t||t.length===0)throw new Error("Players array cannot be empty");if(!e||e.length===0)throw new Error("Matches array cannot be empty");return x.useMemo(()=>{const o=a=>t.find(n=>n.ID===a);return e.map(({pairing:a})=>{const n=o(a[0]),l=o(a[1]);return[a[0]!==p&&n?n.name:"BYE",a[1]!==p&&l?l.name:"BYE"]})},[e,t])}const J=({matches:t,players:e,roundNum:s})=>{const o=E(e,t);return r.jsxs("details",{className:"flex flex-col gap-0.5 border-2 p-0.5",children:[r.jsxs("summary",{children:[r.jsx(N,{}),r.jsx("div",{className:"flex justify-between",children:r.jsx("h3",{className:"h-[54px] w-[54px] rounded-full border-1 border-gray-300 text-center font-bold text-4xl text-gray-300 leading-snug",children:s})})]}),r.jsx("div",{children:t.map((a,n)=>r.jsx(v,{match:a,names:o[n],disabled:!0},a.ID))})]})},K=({matches:t,players:e,roundNum:s,onScoreChange:o})=>{const a=E(e,t);return r.jsxs("div",{className:"flex flex-col gap-0.5 border-2 border-secondary p-0.5",children:[r.jsx(N,{}),r.jsx("div",{className:"flex justify-between",children:r.jsx("h3",{className:"h-[54px] aspect-square rounded-full border-1 border-secondary text-center font-bold text-4xl leading-snug",children:s})}),t.map((n,l)=>r.jsx(v,{match:n,names:a[l],onScoreChange:o},n.ID))]})},b=t=>Symbol.iterator in t,g=t=>"entries"in t,R=(t,e)=>{const s=t instanceof Map?t:new Map(t.entries()),o=e instanceof Map?e:new Map(e.entries());if(s.size!==o.size)return!1;for(const[a,n]of s)if(!Object.is(n,o.get(a)))return!1;return!0},Q=(t,e)=>{const s=t[Symbol.iterator](),o=e[Symbol.iterator]();let a=s.next(),n=o.next();for(;!a.done&&!n.done;){if(!Object.is(a.value,n.value))return!1;a=s.next(),n=o.next()}return!!a.done&&!!n.done};function W(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!b(t)||!b(e)?R({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):g(t)&&g(e)?R(t,e):Q(t,e)}function m(t){const e=I.useRef(void 0);return s=>{const o=t(s);return W(e.current,o)?e.current:e.current=o}}const X=({roundID:t})=>{const e=d(m(k(t))),s=d(o=>o.players);return r.jsx(J,{matches:e,players:s,roundNum:t})},Z=()=>{const t=d(m(S));return r.jsx("div",{className:"py-4",children:t.map(e=>r.jsx("div",{className:"mb-4",children:r.jsx(X,{roundID:e})},e))})},C=()=>{const t=d(n=>n.players),e=d(m(n=>O(n))),s=d(m(n=>n.currentRoundNum)),o=d(n=>n.updateMatch),a=n=>{o(n)};return r.jsx(K,{roundNum:s,matches:e,players:t,onScoreChange:a})},re=()=>{const t=d(T),e=d(s=>s.nextRound);return r.jsxs(L,{children:[r.jsxs(z,{children:[r.jsx(D,{children:"Rounds"}),r.jsxs(B,{children:[r.jsx(C,{}),r.jsx(Z,{})]})]}),r.jsxs(H,{children:[r.jsx(j,{disabled:!t,onClick:()=>e(),iconSlot:r.jsx(M,{}),children:"Next Round"}),r.jsx(j,{onClick:()=>w.tournamentRanking().push(),iconSlot:r.jsx(P,{}),children:"Ranking"})]})]})};export{re as default};
