import{r as p,j as s,R as M,a as S}from"./index-Cj4AogPB.js";import{I as k}from"./IconTabs-Dv5LNASy.js";import{d as v}from"./IconNext-BHDAgClp.js";import{e as y,H as w,u as d,f as C,h as O,i as I,j as T,P as z,a as D,b as H,c as Y,d as $,B as b}from"./PageLayout-C6iXh1e-.js";import{I as B}from"./InputNumber-DGsWnBh-.js";const h=({name:t,score:e,onChange:n,disabled:o,completed:r,variant:a,minPointsToWin:i})=>{const u=o||r?"border-gray-300 text-gray-300":a==="primary"?"border-primary":"border-secondary";return s.jsxs("div",{className:"flex flex-row items-stretch justify-between gap-0.5",children:[s.jsx("h5",{className:`flex flex-auto items-end border px-2 py-1 font-bold text-2xl text-handwritten leading-none ${u}`,children:t}),s.jsx(B,{value:e,onChange:n,maxValue:i,disabled:o,completed:r})]})},E=({names:t,match:e,onScoreChange:n,disabled:o=!1,variant:r="secondary",minPointsToWin:a})=>{const[i,c]=p.useState(!1),f=p.useRef(null),u=l=>{c(l)};p.useEffect(()=>{if(i){const l=setTimeout(()=>{var x;(x=f.current)==null||x.scrollIntoView({block:"center",behavior:"smooth"})},100);return()=>{clearTimeout(l)}}return()=>{}},[i]);const m=e.result.some(l=>l===a);return s.jsxs("div",{ref:f,className:"flex flex-col",children:[s.jsx("div",{className:"focus-within:z-10",children:s.jsx(h,{name:t[0],score:e.result[0],disabled:o,variant:r,onChange:l=>{const x={...e,result:[l,e.result[1]]};n==null||n(x)},onIsEditingChange:u,minPointsToWin:a,completed:m})}),s.jsx("div",{className:"-mt-[1px] focus-within:z-10",children:s.jsx(h,{name:t[1],score:e.result[1],disabled:o,variant:r,onChange:l=>{const x={...e,result:[e.result[0],l]};n==null||n(x)},onIsEditingChange:u,minPointsToWin:a,completed:m})})]})};function P(t,e){if(!t||t.length===0)throw new Error("Players array cannot be empty");if(!e||e.length===0)throw new Error("Matches array cannot be empty");return p.useMemo(()=>{const o=r=>t.find(a=>a.ID===r);return e.map(({pairing:r})=>{const a=o(r[0]),i=o(r[1]);return[r[0]!==y&&a?a.name:"BYE",r[1]!==y&&i?i.name:"BYE"]})},[e,t])}const U=({matches:t,players:e,roundNum:n})=>{const o=P(e,t);return s.jsxs("details",{className:"flex flex-col gap-0.5 border-2 p-0.5",children:[s.jsxs("summary",{children:[s.jsx(w,{}),s.jsx("div",{className:"flex justify-between",children:s.jsx("h3",{className:"h-[54px] w-[54px] rounded-full border-1 border-gray-300 text-center font-bold text-4xl text-gray-300 leading-snug",children:n})})]}),s.jsx("div",{children:t.map((r,a)=>s.jsx(E,{match:r,names:o[a],disabled:!0},r.ID))})]})},V=({matches:t,players:e,roundNum:n,onScoreChange:o,minPointsToWin:r,completed:a})=>{const i=P(e,t),u=a?"border-black text-gray-500":"border-secondary";return s.jsxs("div",{className:`flex flex-col gap-0.5 border-2 p-0.5 ${u}`,children:[s.jsx(w,{}),s.jsx("div",{className:"flex justify-between",children:s.jsx(q,{roundNum:n,completed:a})}),t.map((m,l)=>s.jsx(E,{match:m,names:i[l],onScoreChange:o,minPointsToWin:r},m.ID))]})},q=({roundNum:t,completed:e})=>s.jsx("h3",{className:`aspect-square h-[54px] rounded-full border-2 text-center font-bold text-4xl text-handwritten leading-relaxed ${e?"border-black text-black":"border-secondary"}`,children:t}),R=t=>Symbol.iterator in t,g=t=>"entries"in t,N=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),o=e instanceof Map?e:new Map(e.entries());if(n.size!==o.size)return!1;for(const[r,a]of n)if(!Object.is(a,o.get(r)))return!1;return!0},L=(t,e)=>{const n=t[Symbol.iterator](),o=e[Symbol.iterator]();let r=n.next(),a=o.next();for(;!r.done&&!a.done;){if(!Object.is(r.value,a.value))return!1;r=n.next(),a=o.next()}return!!r.done&&!!a.done};function _(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!R(t)||!R(e)?N({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):g(t)&&g(e)?N(t,e):L(t,e)}function j(t){const e=M.useRef(void 0);return n=>{const o=t(n);return _(e.current,o)?e.current:e.current=o}}const F=({roundID:t})=>{const e=d(j(O(t))),n=d(o=>o.players);return s.jsx(U,{matches:e,players:n,roundNum:t})},G=()=>{const t=d(j(C));return s.jsx("div",{className:"py-4",children:t.map(e=>s.jsx("div",{className:"mb-4",children:s.jsx(F,{roundID:e})},e))})},J=()=>{const t=d(c=>c.players),e=d(j(c=>T(c))),n=d(j(c=>c.currentRoundNum)),o=d(c=>c.updateMatch),r=d(c=>c.minPointsToWin),a=d(c=>I(c)),i=c=>{o(c)};return s.jsx(V,{roundNum:n,matches:e,players:t,onScoreChange:i,minPointsToWin:r,completed:a})},A=()=>{const t=d(I),e=d(n=>n.nextRound);return s.jsxs(z,{children:[s.jsxs(D,{children:[s.jsx(H,{children:"Rounds"}),s.jsxs(Y,{children:[s.jsx(J,{}),s.jsx(G,{})]})]}),s.jsxs($,{children:[s.jsx(b,{disabled:!t,onClick:()=>e(),iconSlot:s.jsx(v,{}),children:"Next Round"}),s.jsx(b,{onClick:()=>S.ranking().push(),iconSlot:s.jsx(k,{}),children:"Ranking"})]})]})};export{A as default};
