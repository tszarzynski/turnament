import{r as p,j as s,R as M,a as S}from"./index-DJf74qFj.js";import{I as k}from"./IconTabs-BQIxVqMv.js";import{d as v}from"./IconNext-DG48STTz.js";import{e as b,H as w,u as d,f as C,h as O,i as I,j as T,P as z,a as D,b as H,c as Y,d as $,B as y}from"./PageLayout-DptF3OHj.js";import{I as B}from"./InputNumber-Cw910SPv.js";const h=({name:e,score:t,onChange:n,disabled:o,completed:r,variant:a,minPointsToWin:l})=>{const u=o||r?"border-gray-300 text-gray-300":a==="primary"?"border-primary":"border-secondary";return s.jsxs("div",{className:"flex flex-row items-stretch justify-between gap-0.5",children:[s.jsx("h5",{className:`flex flex-auto items-end border px-2 py-1 font-bold text-2xl text-handwritten leading-none ${u}`,children:e}),s.jsx(B,{value:t,onChange:n,maxValue:l,disabled:o,completed:r})]})},E=({names:e,match:t,onScoreChange:n,disabled:o=!1,variant:r="secondary",minPointsToWin:a})=>{const[l,c]=p.useState(!1),f=p.useRef(null),u=i=>{c(i)};p.useEffect(()=>{if(l){const i=setTimeout(()=>{var x;(x=f.current)==null||x.scrollIntoView({block:"center",behavior:"smooth"})},100);return()=>{clearTimeout(i)}}return()=>{}},[l]);const m=t.result.some(i=>i===a);return s.jsxs("div",{ref:f,className:"flex flex-col",children:[s.jsx("div",{className:"focus-within:z-10",children:s.jsx(h,{name:e[0],score:t.result[0],disabled:o,variant:r,onChange:i=>{const x={...t,result:[i,t.result[1]]};n==null||n(x)},onIsEditingChange:u,minPointsToWin:a,completed:m})}),s.jsx("div",{className:"-mt-[1px] focus-within:z-10",children:s.jsx(h,{name:e[1],score:t.result[1],disabled:o,variant:r,onChange:i=>{const x={...t,result:[t.result[0],i]};n==null||n(x)},onIsEditingChange:u,minPointsToWin:a,completed:m})})]})};function P(e,t){if(!e||e.length===0)throw new Error("Players array cannot be empty");if(!t)throw new Error("Matches array cannot be null");return p.useMemo(()=>{const o=r=>e.find(a=>a.ID===r);return t.map(({pairing:r})=>{const a=o(r[0]),l=o(r[1]);return[r[0]!==b&&a?a.name:"BYE",r[1]!==b&&l?l.name:"BYE"]})},[t,e])}const U=({matches:e,players:t,roundNum:n})=>{const o=P(t,e);return s.jsxs("details",{className:"flex flex-col gap-0.5 border-2 p-0.5",children:[s.jsxs("summary",{children:[s.jsx(w,{}),s.jsx("div",{className:"flex justify-between",children:s.jsx("h3",{className:"h-[54px] w-[54px] rounded-full border-1 border-gray-300 text-center font-bold text-4xl text-gray-300 leading-snug",children:n})})]}),s.jsx("div",{children:e.map((r,a)=>s.jsx(E,{match:r,names:o[a],disabled:!0},r.ID))})]})},V=({matches:e,players:t,roundNum:n,onScoreChange:o,minPointsToWin:r,completed:a})=>{const l=P(t,e),u=a?"border-black text-gray-500":"border-secondary";return s.jsxs("div",{className:`flex flex-col gap-0.5 border-2 p-0.5 ${u}`,children:[s.jsx(w,{}),s.jsx("div",{className:"flex justify-between",children:s.jsx(q,{roundNum:n,completed:a})}),e.map((m,i)=>s.jsx(E,{match:m,names:l[i],onScoreChange:o,minPointsToWin:r},m.ID))]})},q=({roundNum:e,completed:t})=>s.jsx("h3",{className:`aspect-square h-[54px] rounded-full border-2 text-center font-bold text-4xl text-handwritten leading-relaxed ${t?"border-black text-black":"border-secondary"}`,children:e}),R=e=>Symbol.iterator in e,g=e=>"entries"in e,N=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),o=t instanceof Map?t:new Map(t.entries());if(n.size!==o.size)return!1;for(const[r,a]of n)if(!Object.is(a,o.get(r)))return!1;return!0},L=(e,t)=>{const n=e[Symbol.iterator](),o=t[Symbol.iterator]();let r=n.next(),a=o.next();for(;!r.done&&!a.done;){if(!Object.is(r.value,a.value))return!1;r=n.next(),a=o.next()}return!!r.done&&!!a.done};function _(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null?!1:!R(e)||!R(t)?N({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)}):g(e)&&g(t)?N(e,t):L(e,t)}function j(e){const t=M.useRef(void 0);return n=>{const o=e(n);return _(t.current,o)?t.current:t.current=o}}const F=({roundID:e})=>{const t=d(j(O(e))),n=d(o=>o.players);return s.jsx(U,{matches:t,players:n,roundNum:e})},G=()=>{const e=d(j(C));return s.jsx("div",{className:"py-4",children:e.map(t=>s.jsx("div",{className:"mb-4",children:s.jsx(F,{roundID:t})},t))})},J=()=>{const e=d(c=>c.players),t=d(j(c=>T(c))),n=d(j(c=>c.currentRoundNum)),o=d(c=>c.updateMatch),r=d(c=>c.minPointsToWin),a=d(c=>I(c)),l=c=>{o(c)};return s.jsx(V,{roundNum:n,matches:t,players:e,onScoreChange:l,minPointsToWin:r,completed:a})},A=()=>{const e=d(I),t=d(n=>n.nextRound);return s.jsxs(z,{children:[s.jsxs(D,{children:[s.jsx(H,{children:"Rounds"}),s.jsxs(Y,{children:[s.jsx(J,{}),s.jsx(G,{})]})]}),s.jsxs($,{children:[s.jsx(y,{disabled:!e,onClick:()=>t(),iconSlot:s.jsx(v,{}),children:"Next"}),s.jsx(y,{onClick:()=>S.ranking().push(),iconSlot:s.jsx(k,{}),children:"Ranking"})]})]})};export{A as default};
